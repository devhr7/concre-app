---
deployment:
  tasks:
    - export APP="/home/concr/repositories/concre-app"
    - export PHP="/opt/cpanel/ea-php82/root/usr/bin/php"
    - export COMPOSER="/opt/cpanel/composer/bin/composer"
    - export PATH="$HOME/.nvm/versions/node/v18.19.0/bin:$PATH"   # ajusta la ruta seg√∫n tu node

    # Backend
    - $COMPOSER --working-dir=$APP install --no-dev --optimize-autoloader

    # Frontend (Vite)
    - cd $APP
    - npm ci
    - npm run build

    # Laravel post-build
    - $PHP $APP/artisan storage:link || true
    - $PHP $APP/artisan optimize:clear
    - $PHP $APP/artisan config:cache
    - $PHP $APP/artisan route:cache
    - $PHP $APP/artisan view:cache

    # Permisos
    - chmod -R ug+rw $APP/storage $APP/bootstrap/cache
